<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Sleep Outside | Cart</title>

    <link rel="stylesheet" href="/css/style.css" />

    <script src="../js/cart.js" type="module"></script>
  </head>

  <body>
    
    <header class="divider" id="main-header"></header>

    <main class="divider">
      <section class="products">
        <h2>My Cart</h2>

        <ul class="product-list">
          <!-- <li id="1308" class="cart-card divider">
            <a href="product_pages/marmot-ajax-3.html" class="cart-card__image">
              <img src="" alt="Marmot Ajax tent"/>
            </a>
            <a href="product_pages/marmot-ajax-3.html">
              <h2 class="card__name">Marmot Ajax Tent - 3-Person, 3-Season</h2>
            </a>
            <p class="cart-card__color">Pale Pumpkin/Terracotta</p>
            <p class="cart-card__quantity">qty: 1</p>
            <p class="cart-card__price">$199.99</p>
            <button type='button' class="remove_item" onclick="remove_li('1308')">X</button>
          </li>
          
          <li class="cart-card divider">
            <a href="product_pages/marmot-ajax-3.html" class="cart-card__image">
              <img
                src="images/tents/the-north-face-talus-tent-4-person-3-season-in-golden-oak-saffron-yellow~p~985rf_01~320.jpg"
                alt="Talus Tent - 4-Person, 3-Season"
              />
            </a>
            <a href="product_pages/marmot-ajax-3.html">
              <h2 class="card__name">
                The North Face Talus Tent - 4-Person, 3-Season
              </h2></a
            >
            <p class="cart-card__color">Golden Oak/Saffron Yellow</p>
            <p class="cart-card__quantity">qty: 1</p>
            <p class="cart-card__price">$199.99</p>
          </li> -->
        </ul>
        <!-- Adding HTML structure for the cart total - km -->
        <div class="cart-footer hide">
          <p class="cart-total">Total: $<span id="cart-total"></span></p>
        </div>
      </section>
    </main>

    <footer id="main-footer"></footer>

    <script type="text/javascript">
      // Fuad added this

      function remove_li(id) {
        let ul = document.querySelector(".product-list");
        let li = document.getElementById(id);
        ul.remove(li);

        let so_cart = JSON.parse(localStorage.getItem("so-cart"));
        let cartArray = [].concat(so_cart); //console.log(cartArray[0]["Brand"]["Id"]);
        let newArray = cartArray.filter((cart_item) => cart_item["Id"] !== id);

        const total = newArray.reduce((sum, item) => sum + item.FinalPrice, 0);
        document.getElementById("cart-total").textContent = total.toFixed(2);
        document.querySelector(".cart-footer").classList.add("show");

        // this logic it to check if the cart is empty and display an appropriate message if it is.
        document.querySelector("#cart-count").textContent = newArray.length;
        if (newArray.length == 0) {
          document.querySelector("#cart-count").style.display = "none";
        } else {
          document.querySelector("#cart-count").style.display = "";
        }

        localStorage.setItem("so-cart", JSON.stringify(newArray));
        location.reload();
      }
    </script>
  </body>
</html>
